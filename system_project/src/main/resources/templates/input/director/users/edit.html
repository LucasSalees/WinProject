<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema - WinProject</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/base.css?v=1.0}">
    <link rel="stylesheet" th:href="@{/css/components.css?v=1.0}">
    <link rel="stylesheet" th:href="@{/css/edits/editUsers.css?v=1.0}">
    <link rel="stylesheet" th:href="@{/css/lists/usersList.css?v=1.0}">
</head>

<body>
    
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
    
    <div th:replace="~{fragments/navbar :: navbar(pageTitle=' Editar usuário')}"></div>
    
    <main id="main-content" class="main-content">
        <div class="container">
            <div class="card">
                <form action="/input/director/users/edit" th:object="${user}" method="POST" id="formulario"
                	style="display: none;">
                    
                    <!-- Seção: Foto de Perfil -->
					<div class="section-card access-config-section">
					    <h3 class="section-title">
					        <i class="fas fa-user"></i>
					        Foto de Perfil
					    </h3>
					
					    <div class="row g-3 justify-content-center">
					        <div class="col-md-4 text-center">
					
					            <!-- Imagem de perfil -->
					            <img id="photoPreview"
								     class="img-preview rounded-circle shadow d-block mx-auto mb-2"
								     th:src="${user.photoPath == null or user.photoPath == '' or user.photoPath == 'DefaultAvatar.png'} ?
								             @{/images/DefaultAvatar.png} :
								             @{/user-photos/{file}(file=${user.photoPath})}"
								     alt="Preview" />
					
					            <!-- Input invisível -->
					            <input type="file"
					                   id="profileImage"
					                   name="profileImage"
					                   accept="image/*"
					                   class="d-none"
					                   onchange="previewPhoto(this)" />
					
					            <!-- Botão “Escolher Arquivo” -->
					            <label for="profileImage" class="btn btn-primary"> <i class="fa-solid fa-pencil"></i>
					                Escolher arquivo
					            </label>
					
								<!-- Botão de excluir (só aparece quando uma foto é selecionada) -->
								<a href="#"
								   class="btn btn-danger"
								   id="btnRemovePhoto"
								   style="display: none;"
								   onclick="openExclusaoFotoModal(); return false;">
								    <i class="fa-solid fa-trash" style="color: #ffffff;"></i> Excluir
								</a>

					        </div>
					    </div>
					</div>

		            <div class="section-card personal-info-section">
	                    <h3 class="section-title">
	                        <i class="fas fa-user"></i>
	                        Dados Pessoais
	                    </h3>
	                    
						<div class="row g-3">
							 <div class="col-md-1">
	                            <label class="form-label shadow-text">Cód</label>
	                        	<input type="text" id="id-usuario" placeholder="Digite o nome completo"
    							class="form-control shadow-cantos" disabled th:value="${user.userId}" />
	                        </div>
	                        
							<!-- Oculto, mas enviado -->
							<input type="hidden" name="userId" th:value="${user.userId}" />
	                        
	                        <div class="col-md-5">
	                            <label class="form-label shadow-text">Nome completo</label>
	                            <input type="text" name="userName" placeholder="Digite o nome completo"
	                                class="form-control shadow-cantos" required maxlength="60" th:field="*{userName}"/>
	                        </div>
	                        
	                        <div class="col-md-6">
	                            <label class="form-label shadow-text">Celular</label>
	                            <input type="text" name="userTel" placeholder="(00) 00000-0000" id="userTel"
	                                class="form-control shadow-cantos" required th:field="*{userTel}"/>
	                        </div>
	                        
							<div class="form-section-header-department col-md-6">
							    <div class="d-flex align-items-center mb-2">
							        <label class="form-label shadow-text me-2 mb-0">
							            <i class="fas fa-user-tie me-1"></i>
							            Profissão
							        </label>
							    </div>
							    
							    <label class="form-label text-muted small">Cod - Nome</label>
							    
							    <div class="time-range-container">
							        <div class="form-control shadow-cantos" id="campoProfissao" style="cursor: pointer;">
							            <!-- Apenas UM span com ID -->
							            <span th:if="${user.userOccupation != null}"
							                  id="textoProfissaoSelecionada"
							                  th:attr="data-nome=${user.userOccupation.occupationName}"
							                  th:text="${user.userOccupation.occupationId + ' - ' + user.userOccupation.occupationName}">
							            </span>
							
							            <span th:if="${user.userOccupation == null}"
							                  id="textoProfissaoSelecionada"
							                  data-nome=""
							                  >
							                Selecione uma profissão
							            </span>
							        </div>
							
							        <input type="hidden" name="userOccupation" id="userOccupation"
							               th:value="${user.userOccupation != null ? user.userOccupation.occupationId : ''}">
							    </div>
							</div>
							
							<div class="form-section-header-department col-md-6">
							    <div class="d-flex align-items-center mb-2">
							        <label class="form-label shadow-text me-2 mb-0">
							            <i class="fas fa-user-tie me-1"></i>
							            Função
							        </label>
							    </div>
							    
							    <label class="form-label text-muted small">Cod - Nome</label>
							    
							    <div class="time-range-container">
							        <div class="form-control shadow-cantos" id="campoFuncao" style="cursor: pointer;">
							            <!-- Apenas UM span com ID -->
							            <span th:if="${user.userFunction != null}"
							                  id="textoFuncaoSelecionada"
							                  th:attr="data-nome=${user.userFunction.functionName}"
							                  th:text="${user.userFunction.functionId + ' - ' + user.userFunction.functionName}">
							            </span>
							
							            <span th:if="${user.userFunction == null}"
							                  id="textoFuncaoSelecionada"
							                  data-nome=""
							                  >
							                Selecione uma função
							            </span>
							        </div>
							
							        <input type="hidden" name="userFunction" id="userFunction"
							               th:value="${user.userFunction != null ? user.userFunction.functionId : ''}">
							    </div>
							</div>
							
							<div class="form-section-header-department col-md-6">
							    <div class="d-flex align-items-center mb-2">
							        <label class="form-label shadow-text me-2 mb-0">
							            <i class="fas fa-user-tie me-1"></i>
							            Departamento
							        </label>
							    </div>
							    
							    <label class="form-label text-muted small">Cod - Nome</label>
							    
							    <div class="time-range-container">
							        <div class="form-control shadow-cantos" id="campoDepartamento" style="cursor: pointer;">
							            <!-- Apenas UM span com ID -->
							            <span th:if="${user.userDepartment != null}"
							                  id="textoDepartamentoSelecionada"
							                  th:attr="data-nome=${user.userDepartment.departmentName}"
							                  th:text="${user.userDepartment.departmentId + ' - ' + user.userDepartment.departmentName}">
							            </span>
							
							            <span th:if="${user.userDepartment == null}"
							                  id="textoDepartamentoSelecionada"
							                  data-nome=""
							                  >
							                Selecione uma departamento
							            </span>
							        </div>
							
							        <input type="hidden" name="userDepartment" id="userDepartment"
							               th:value="${user.userDepartment != null ? user.userDepartment.departmentId : ''}">
							    </div>
							</div>
	                        
	                        <div class="form-section-header-department col-md-6">
							    <div class="d-flex align-items-center mb-2">
							        <label class="form-label shadow-text me-2 mb-0">
							            <i class="fas fa-location-dot me-1"></i>
							            Região
							        </label>
							    </div>
							    <label class="form-label text-muted small">UF</label>
							    <div class="time-range-container">
							        <select th:field="*{userRegion}" class="form-control shadow-cantos" required>
									    <option value="" disabled selected>Selecione uma região</option>
									    <option th:each="reg : ${T(com.project.system.enums.input.UserRegion).values()}"
									            th:value="${reg}"
									            th:text="${reg.label}">Região</option>
									</select>
							    </div>
							</div>
	                    </div>
	                </div>
		
		            <!-- Seção: Configurações de Segurança -->
		            <div class="section-card  access-config-section">
		                <h3 class="section-title">
		                    <i class="fas fa-shield-alt"></i>
		                    Configurações de Segurança
		                </h3>
		                
		                <div class="row g-3">
							<div class="col-md-6">
							    <label for="email-usuario" class="form-label">E-mail</label>
							    <div class="input-group has-validation">
									<input type="email" th:field="*{userEmail}" name="userEmail" id="email-usuario" 
									       class="form-control shadow-cantos" required
									       placeholder="Digite o e-mail completo (ex: usuario@email.com)" 
									       maxlength="60"
									       aria-describedby="emailFeedback inputGroupPrependEmail"
									       oninput="validarEmail(this)">

							        <div id="emailFeedback" class="invalid-feedback">
							            Este email já está cadastrado. Por favor, use outro email.
							        </div>
							        <div id="emailSuccess" class="valid-feedback">
							            Email disponível!
							        </div>
							    </div>
							</div>

							<div class="col-md-6">
		                        <div class="d-flex align-items-center mb-2">
		                            <label class="form-label shadow-text me-2 mb-0">Nova Senha</label>
		                            <div class="tooltip-container">
		                                <i class="fas fa-info-circle text-primary" style="cursor: help;"></i>
		                                <span class="tooltip-text">Digite a nova senha de no máximo 15 caracteres. Deixe em branco para manter a senha atual.</span>
		                            </div>                            
		                        </div>
		                        <div class="input-with-icon">
		                            <input type="password" name="novaSenha" id="senha" placeholder="Nova senha (opcional)" 
		                                class="form-control shadow-cantos input-senha" maxlength="15">
		                            <i class="fas fa-eye" onclick="togglePassword()"></i>
		                        </div>
		                        <div class="password-strength">
		                            <small class="text-muted">
		                                <i class="fas fa-shield-alt"></i>
		                                Força da senha: <span id="forca-text"> Não informada </span>
		                            </small>
		                            <div class="strength-bar">
		                                <div class="strength-fill" id="strengthFill"></div>
		                            </div>
		                        </div>
		                    </div>
		                </div>

	                    <div class="row g-3 mt-2">
						    <div class="col-md-12">
						        <label class="form-label shadow-text">Tipo de Usuário</label>
						        <select id="userRoleSelect" name="userRole" class="form-control shadow-cantos" th:field="*{userRole}" required>
						            <option value="" disabled selected>Selecione o tipo</option>
						            <option th:each="userRole : ${T(com.project.system.enums.input.UserRole).values()}"
						                    th:value="${userRole}"
						                    th:text="${userRole.label}">Tipo</option>
						        </select>
						
						        <!-- Aqui aparece a descrição -->
						        <div id="roleDescription" class="mt-2 text-muted"></div>
						    </div>
						</div>
	                </div>

	               <div class="section-card access-config-section permission-group user-group">
	                   <h3 class="section-title">
	                       <i class="fas fa-lock"></i>
	                       Permissões de usuários
	                   </h3>
    
						<div class="form-switch mb-2">
						    <input class="form-check-input"
						           type="checkbox"
						           id="checkAllUser"
						           th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('USER_')].![name()]
						           )}">
						    <label class="form-check-label" for="checkAllUser">Marcar Todos</label>
						</div>
					    
					    <div class="dias-container">
					        <div th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
					             th:if="${permission.name().startsWith('USER_')}"
					             class="dia-item form-switch">
					
					            <input class="form-check-input shadow-cantos"
					                   type="checkbox"
					                   th:id="${'perm_' + permission.name()}"
					                   th:name="permissions"
					                   th:value="${permission.name()}"
					                   th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">
					
					            <label class="form-check-label"
					                   th:for="${'perm_' + permission.name()}"
					                   th:text="${permission.label}">Permissão</label>
					        </div>
					    </div>
					</div>
					
					<!-- Permissões de Departamento -->
	               <div class="section-card access-config-section permission-group department-group">
	                   <h3 class="section-title">
	                       <i class="fas fa-lock"></i>
	                       Permissões de departamentos
	                   </h3>
	                   
	                   <div class="form-switch mb-2">
					        <input class="form-check-input"
						           type="checkbox"
						           id="checkAllDepartment"
						           th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('DEPARTMENT_')].![name()]
						           )}">
					        <label class="form-check-label" for="checkAllDepartment">Marcar Todos</label>
					    </div>
					    
					    <div class="dias-container">
					        <div th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
					             th:if="${permission.name().startsWith('DEPARTMENT_')}"
					             class="dia-item form-switch">
					
					            <input class="form-check-input shadow-cantos"
					                   type="checkbox"
					                   th:id="${'perm_' + permission.name()}"
					                   th:name="permissions"
					                   th:value="${permission.name()}"
					                   th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">
					
					            <label class="form-check-label"
					                   th:for="${'perm_' + permission.name()}"
					                   th:text="${permission.label}">
					                Permissão
					            </label>
					        </div>
					    </div>
					</div>
					
					<!-- Permissões de Profissões -->
	               <div class="section-card access-config-section permission-group occupation-group">
	                   <h3 class="section-title">
	                       <i class="fas fa-lock"></i>
	                       Permissões de profissões
	                   </h3>
	                   
	                   	<div class="form-switch mb-2">
					        <input class="form-check-input"
						           type="checkbox"
						           id="checkAllOccupation"
						           th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('OCCUPATION_')].![name()]
						           )}">
					        <label class="form-check-label" for="checkAllOccupation">Marcar Todos</label>
					    </div>
					    
					    <div class="dias-container">
					        <div th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
					             th:if="${permission.name().startsWith('OCCUPATION_')}"
					             class="dia-item form-switch">
					
					            <input class="form-check-input shadow-cantos"
					                   type="checkbox"
					                   th:id="${'perm_' + permission.name()}"
					                   th:name="permissions"
					                   th:value="${permission.name()}"
					                   th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">
					
					            <label class="form-check-label"
					                   th:for="${'perm_' + permission.name()}"
					                   th:text="${permission.label}">
					                Permissão
					            </label>
					        </div>
					    </div>
					</div>
					
					<!-- Permissões de Funções -->
					<div class="section-card access-config-section permission-group function-group">
	                   <h3 class="section-title">
	                       <i class="fas fa-lock"></i>
	                       Permissões de funções
	                   </h3>
	                   
	                   <div class="form-switch mb-2">
					        <input class="form-check-input"
						           type="checkbox"
						           id="checkAllFunction"
						           th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('FUNCTION_')].![name()]
						           )}">
					        <label class="form-check-label" for="checkAllFunction">Marcar Todos</label>
					    </div>
					    
					    <div class="dias-container">
					        <div th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
					             th:if="${permission.name().startsWith('FUNCTION_')}"
					             class="dia-item form-switch">
					
					            <input class="form-check-input shadow-cantos"
					                   type="checkbox"
					                   th:id="${'perm_' + permission.name()}"
					                   th:name="permissions"
					                   th:value="${permission.name()}"
					                   th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">
					
					            <label class="form-check-label"
					                   th:for="${'perm_' + permission.name()}"
					                   th:text="${permission.label}">
					                Permissão
					            </label>
					        </div>
					    </div>
					</div>
					
					<!-- Permissões de Projetos -->
					<div class="section-card access-config-section permission-group project-group">
	                   <h3 class="section-title">
	                       <i class="fas fa-lock"></i>
	                       Permissões de projetos
	                   </h3>
	                   
	                   <div class="form-switch mb-2">
					        <input class="form-check-input"
						           type="checkbox"
						           id="checkAllProject"
						           th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('PROJECT_')].![name()]
						           )}">
					        <label class="form-check-label" for="checkAllProject">Marcar Todos</label>
					    </div>
					    
					    <div class="dias-container">
					        <div th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
					             th:if="${permission.name().startsWith('PROJECT_')}"
					             class="dia-item form-switch">
					
					            <input class="form-check-input shadow-cantos"
					                   type="checkbox"
					                   th:id="${'perm_' + permission.name()}"
					                   th:name="permissions"
					                   th:value="${permission.name()}"
					                   th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">
					
					            <label class="form-check-label"
					                   th:for="${'perm_' + permission.name()}"
					                   th:text="${permission.label}">
					                Permissão
					            </label>
					        </div>
					    </div>
					</div>

					<!-- Permissões de Sigla contratual -->
					<div
						class="section-card access-config-section permission-group acronym-group">
						<h3 class="section-title">
							<i class="fas fa-lock"></i> Permissões de Sigla contratual
						</h3>

						<div class="form-switch mb-2">
							<input class="form-check-input" type="checkbox"
								id="checkAllAcronym"
								th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('CONTRACTUAL_')].![name()]
						           )}">
							<label class="form-check-label" for="checkAllAcronym">Marcar
								Todos</label>
						</div>

						<div class="dias-container">
							<div
								th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
								th:if="${permission.name().startsWith('CONTRACTUAL_')}"
								class="dia-item form-switch">

								<input class="form-check-input shadow-cantos" type="checkbox"
									th:id="${'perm_' + permission.name()}" th:name="permissions"
									th:value="${permission.name()}"
									th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">

								<label class="form-check-label"
									th:for="${'perm_' + permission.name()}"
									th:text="${permission.label}"> Permissão </label>
							</div>
						</div>
					</div>
					
					<div class="section-card access-config-section permission-group report-group">
						<h3 class="section-title">
							<i class="fas fa-lock"></i> Permissões de relatórios
						</h3>

						<div class="form-switch mb-2">
							<input class="form-check-input" type="checkbox"
								id="checkAllReport"
								th:checked="${#lists.containsAll(
						                user?.permissions != null ? user.permissions.![name()] : {},
						                T(com.project.system.enums.input.UserPermission).values().?[name().startsWith('REPORT_')].![name()]
						           )}">
							<label class="form-check-label" for="checkAllReport">Marcar Todos</label>
						</div>

						<div class="dias-container">
							<div
								th:each="permission : ${T(com.project.system.enums.input.UserPermission).values()}"
								th:if="${permission.name().startsWith('REPORT_')}"
								class="dia-item form-switch">

								<input class="form-check-input shadow-cantos" type="checkbox"
									th:id="${'perm_' + permission.name()}" th:name="permissions"
									th:value="${permission.name()}"
									th:checked="${#lists.contains(user?.permissions?.![name()], permission.name())}">

								<label class="form-check-label"
									th:for="${'perm_' + permission.name()}"
									th:text="${permission.label}"> Permissão </label>
							</div>
						</div>
					</div>

					<!-- Seção: Status do Usuário -->
					<div class="row g-3">

					    <div class="col-md-3">
					        <div class="section-card block-section">
					            <h3 class="section-title">
					                <i class="fas fa-user-lock"></i>
					                Bloquear Usuário
					            </h3>
					            <div class="row g-3">
					                <div class="col-12">
					                    <div class="form-section-headerblock-user-section">
					                        <div class="d-flex align-items-center gap-3">
					                            <div class="form-check form-switch m-0">
					                                <input type="checkbox" th:field="*{userLocked}" id="bloqueio1" value="true"
					                                    class="form-check-input block-checkbox" />
					                            </div>
					                            <div class="text-block">
					                                <label for="bloqueio1" class="form-label shadow-text mb-1" style="cursor: pointer;">
					                                    <i class="fas fa-ban me-2"></i>
					                                    Bloquear Usuário
					                                </label>
					                                <div class="text-muted small">
					                                    Ao marcar esta opção, o acesso do usuário ao sistema será bloqueado.
					                                </div>
					                            </div>
					                        </div>
					                    </div>
					                </div>
					            </div>
					        </div>
					    </div>

					    <div class="col-md-3">
					        <div class="section-card acctive-section">
					            <h3 class="section-title">
					                <i class="fa-solid fa-user-check"></i>
					                Usuário Ativo
					            </h3>
					            <div class="row g-3">
					                <div class="col-12">
					                    <div class="form-section-headerblock-user-section">
					                        <div class="d-flex align-items-center gap-3">
					                            <div class="form-check form-switch m-0">
					                                <input type="checkbox" th:field="*{userActive}" id="bloqueio2" value="true"
					                                    class="form-check-input block-checkbox" />
					                            </div>
					                            <div class="text-block">
					                                <label for="bloqueio2" class="form-label shadow-text mb-1" style="cursor: pointer;">
					                                    <i class="fas fa-check me-2"></i>
					                                    Usuário Ativo
					                                </label>
					                                <div class="text-muted small">
					                                    Marque esta opção para permitir o acesso do usuário ao sistema.
					                                </div>
					                            </div>
					                        </div>
					                    </div>
					                </div>
					            </div>
					        </div>
					    </div>
				
					    <div class="col-md-3">
					        <div class="section-card inactive-section">
					            <h3 class="section-title">
					                <i class="fas fa-user-slash me-2"></i>
					                Usuário Inativo
					            </h3>
					            <div class="row g-3">
					                <div class="col-12">
					                    <div class="form-section-headerblock-user-section">
					                        <div class="d-flex align-items-center gap-3">
					                            <div class="form-check form-switch m-0">
					                                <input type="checkbox" th:field="*{userInactive}" id="bloqueio3" value="true"
					                                    class="form-check-input block-checkbox" />
					                            </div>
					                            <div class="text-block">
					                                <label for="bloqueio3" class="form-label shadow-text mb-1" style="cursor: pointer;">
					                                    <i class="fa-solid fa-link-slash"></i>
					                                    Usuário Inativo
					                                </label>
					                                <div class="text-muted small">
					                                    Marque esta opção para desativar o acesso do usuário ao sistema.
					                                </div>
					                            </div>
					                        </div>
					                    </div>
					                </div>
					            </div>
					        </div>
					        
					   </div>
				
					    <div class="col-md-3">
					        <div class="section-card suspended-section">
					            <h3 class="section-title">
					                <i class="fa-solid fa-user-xmark"></i>
					                Usuário Afastado
					            </h3>
					            <div class="row g-3">
					                <div class="col-12">
					                    <div class="form-section-headerblock-user-section">
					                        <div class="d-flex align-items-center gap-3">
					                            <div class="form-check form-switch m-0">
					                                <input type="checkbox" th:field="*{userSuspended}" id="bloqueio4" value="true"
					                                    class="form-check-input block-checkbox" />
					                            </div>
					                            <div class="text-block">
					                                <label for="bloqueio4" class="form-label shadow-text mb-1" style="cursor: pointer;">
					                                    <i class="fas fa-pause-circle me-2"></i>
					                                    Usuário Afastado
					                                </label>
					                                <div class="text-muted small">
					                                    Marque esta opção se o usuário estiver afastado.
					                                </div>
					                            </div>
					                        </div>
					                    </div>
					                </div>
					            </div>
					        </div>
					    </div>
					</div>

		            <!-- Seção: Permissões de Horário e Dias -->
					<div class="section-card permissions-section">
					    <h3 class="section-title">
					        <i class="fas fa-clock"></i>
					        Permissões de Horário e Dias
					    </h3>
					    
					    <!-- Horários Permitidos -->
					    <div class="form-section-header">
					        <div class="d-flex align-items-center mb-2">
					            <label class="form-label shadow-text me-2 mb-0">
					                <i class="fas fa-business-time me-1"></i>
					                Horário Permitido
					            </label>
					            <div class="tooltip-container">
					                <i class="fas fa-info-circle text-primary" style="cursor: help;"></i>
					                <span class="tooltip-text">Para não ter restrições de horário, deixe os campos em branco. O usuário poderá acessar o sistema 24 horas.</span>
					            </div>
					        </div>
					        <div class="time-range-container">
					            <div class="flex-grow-1">
					                <label class="form-label text-muted small">Início</label>
					                <input type="time" name="startTime" class="form-control shadow-cantos" th:field="*{startTime}">
					            </div>
					            <span class="ate">até</span>
					            <div class="flex-grow-1">
					                <label class="form-label text-muted small">Fim</label>
					                <input type="time" name="endTime" class="form-control shadow-cantos" th:field="*{endTime}">
					            </div>
					        </div>
					    </div>
					    
					    <!-- Dias Permitidos -->
					    <div class="mt-4">
					        <label class="form-label shadow-text">
					            <i class="fas fa-calendar-week me-1"></i>
					            Dias da Semana Permitidos
					        </label>
					        <div class="dias-container">
					            <!-- Dias da semana com switch -->
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Segunda" id="segunda" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="segunda">Segunda</label>
					            </div>
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Terça" id="terca" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="terca">Terça</label>
					            </div>
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Quarta" id="quarta" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="quarta">Quarta</label>
					            </div>
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Quinta" id="quinta" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="quinta">Quinta</label>
					            </div>
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Sexta" id="sexta" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="sexta">Sexta</label>
					            </div>
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Sábado" id="sabado" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="sabado">Sábado</label>
					            </div>
					            <div class="dia-item form-switch">
					                <input class="form-check-input shadow-cantos" type="checkbox" name="allowedDays" value="Domingo" id="domingo" th:field="*{allowedDays}" checked>
					                <label class="form-check-label" for="domingo">Domingo</label>
					            </div>
					        </div>	
					        
							<div class="container mt-3">
							  <div class="row justify-content-center g-3">
							    <div class="col-auto">
									<button type="button" 
									   class="btn btn-success btn-sm d-flex align-items-center justify-content-center gap-1" 
									   style="width: 210px;" 
									   onclick="selectAll()">
									<i class="fas fa-check-double"></i>
									Selecionar Todos
									</button>
							    </div>
							    <div class="col-auto">
							      <button type="button" 
							      	   class="btn btn-secondary btn-sm d-flex align-items-center justify-content-center gap-1" 
									   style="width: 210px;" 
									   onclick="weekdaySelect()">
							        <i class="fas fa-briefcase"></i> Apenas Dias Úteis
							      </button>
							    </div>
							    <div class="col-auto">
							      <button type="button" 
							      	   class="btn btn-warning btn-sm d-flex align-items-center justify-content-center gap-1" 
									   style="width: 210px;"
									   onclick="weekendSelect()">
							        <i class="fas fa-calendar"></i> Apenas Fim de Semana
							      </button>
							    </div>
							    <div class="col-auto">
							      <button type="button" 
							          class="btn btn-danger btn-sm d-flex align-items-center justify-content-center gap-1" 
									   style="width: 210px;"
									   onclick="disableAll()">
							        <i class="fas fa-times"></i> Desmarcar Todos
							      </button>
							    </div>
							  </div>
							</div>

					    </div>
					</div>

                    <div class="navegacaoLista custom-button-container">
	                    <a th:href="@{/input/director/removeUser/{userId}(userId=${user.userId})}"
						   class="btn btn-danger"
						   onclick="openExclusaoModal(this); return false;">
						    <i class="fa-solid fa-trash" style="color: #ffffff;"></i> Excluir
						</a>

                        <div>
						    <button 
						        type="submit" 
						        class="btn btn-primary"
						        onclick="salvarEdicaoUsuario(event, this.form)">
						        <i class="fa-solid fa-floppy-disk"></i> 
						        Salvar
						    </button>
						</div>
                    </div>
                </form>
            </div>
        </div>
    </main>
    
	<div id="exclusaoModal" class="modal">
	    <div class="modal-container">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h2 class="modal-title">Confirmação</h2>
	                <button type="button" class="modal-close" id="fecharExclusaoModal">
	                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
	                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
	                        <line x1="18" y1="6" x2="6" y2="18"></line>
	                        <line x1="6" y1="6" x2="18" y2="18"></line>
	                    </svg>
	                </button>
	            </div>
	            <div class="modal-body">
	                <p>Tem certeza que deseja excluir?</p>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" id="cancelarExclusao">Cancelar</button>
	                <a id="confirmarExclusaoBtn" class="btn btn-danger">Excluir</a>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- MODAL DE SELEÇÃO DE PROFISSÃO -->
	<div id="modalListaProfissoes" class="modal">
	    <div class="modal-container" style="max-width: 90vw; width: 1000px;">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h2 class="modal-title">Selecionar profissão</h2>
	                <button type="button" class="modal-close" id="fecharModalLista">
	                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
	                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
	                        <line x1="18" y1="6" x2="6" y2="18"></line>
	                        <line x1="6" y1="6" x2="18" y2="18"></line>
	                    </svg>
	                </button>
	            </div>
	            <div class="modal-body">
	
	                <!-- BARRA DE FILTRO E DROPDOWN -->
	                <div class="form-inline mb-3">
	                    <div class="navegacaoLista custom-button-container">
						    <!-- Botão à esquerda -->
						    <div class="botoes-esquerda">
						        
						    </div>
						    <!-- Campo de pesquisa + botão de dropdown à direita -->
						    <div class="botoes-direita">
						        <input type="text" id="filtro" class="form-control shadow-cantos" placeholder="Pesquisar...">
								<div class="dropdown botoes">
								  <button class="btn btn-primary" type="button" id="dropdownMenuButton">
								      Selecionar
								  </button>
								  <div class="dropdown-menu" id="dropdownCampos">
								      <h1 class="dropdown-item-titulo text-center">Campos Visíveis</h1>
								      <label class="dropdown-item-1"><input type="checkbox" id="selecionarTodos"> <span>Selecionar Todos</span></label>
								      <label class="dropdown-item-1"><input type="checkbox" class="campoCheckbox" id="campoCodigo" checked> <span>Codigo</span></label>
								      <label class="dropdown-item-1"><input type="checkbox" class="campoCheckbox" id="campoNome" checked> <span>Nome</span></label>
								  </div>
								</div>
						    </div>
						</div>
	                </div>
	
	                <!-- TABELA DE PROFISSÕES -->
	                <div class="table-container-modal">
	                    <table class="table table-striped" id="tabela">
	                        <thead>
	                            <tr>
	                                <th class="text-left">Cod</th>
	                                <th class="text-left">Nome</th>
	                            </tr>
	                        </thead>
	                        <tbody>
	                            <tr th:each="occupation : ${occupations}" class="linha-profissao" style="cursor: pointer;"
	                                th:data-id="${occupation.occupationId}" th:data-nome="${occupation.occupationName}">
	                                <td th:text="${occupation.occupationId}"></td>
	                                <td th:text="${occupation.occupationName}"></td>
	                            </tr>
	                        </tbody>
	                    </table>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- MODAL DE SELEÇÃO DE PROFISSÃO -->
	<div id="modalListaFuncoes" class="modal">
	    <div class="modal-container" style="max-width: 90vw; width: 1000px;">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h2 class="modal-title">Selecionar função</h2>
	                <button type="button" class="modal-close" id="fecharModalListaFuncao">
	                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
	                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
	                        <line x1="18" y1="6" x2="6" y2="18"></line>
	                        <line x1="6" y1="6" x2="18" y2="18"></line>
	                    </svg>
	                </button>
	            </div>
	            <div class="modal-body">
	
	                <!-- BARRA DE FILTRO E DROPDOWN -->
	                <div class="form-inline mb-3">
	                    <div class="navegacaoLista custom-button-container">
						    <!-- Botão à esquerda -->
						    <div class="botoes-esquerda">
						        
						    </div>
						    <!-- Campo de pesquisa + botão de dropdown à direita -->
						    <div class="botoes-direita">
						        <input type="text" id="filtroFuncoes"class="form-control shadow-cantos"  placeholder="Pesquisar...">
								<div class="dropdown botoes">
								  <button class="btn btn-primary" type="button" id="dropdownMenuButtonFuncoes">
									<svg xmlns="http://www.w3.org/2000/svg" 
								       width="16" height="16" fill="currentColor" 
								       class="bi bi-search" viewBox="0 0 16 16">
								    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 
								      1 0 0 0 1.415-1.414l-3.85-3.85zm-5.242 1.398a5 5 0 1 1 0-10 
								      5 5 0 0 1 0 10z"/>
								  	</svg>
								  </button>
								  <div class="dropdown-menu" id="dropdownCamposFuncoes">
								      <h1 class="dropdown-item-titulo text-center">Campos Visíveis</h1>
								      <label class="dropdown-item-1"><input type="checkbox" id="selecionarTodosFuncoes"> <span>Selecionar Todos</span></label>
								      <label class="dropdown-item-1"><input type="checkbox" class="campoCheckbox" id="campoCodigoFuncao" checked> <span>Codigo</span></label>
								      <label class="dropdown-item-1"><input type="checkbox" class="campoCheckbox" id="campoNomeFuncao" checked> <span>Nome</span></label>
								  </div>
								</div>
						    </div>
						</div>
	                </div>
	
	                <!-- TABELA DE PROFISSÕES -->
	                <div class="table-container-modal">
	                    <table class="table table-striped" id="tabela">
	                        <thead>
	                            <tr>
	                                <th class="text-left">Cod</th>
	                                <th class="text-left">Nome</th>
	                            </tr>
	                        </thead>
	                        <tbody>
	                            <tr th:each="function : ${functions}" class="linha-funcao" style="cursor: pointer;"
	                                th:data-id="${function.functionId}" th:data-nome="${function.functionName}">
	                                <td th:text="${function.functionId}"></td>
	                                <td th:text="${function.functionName}"></td>
	                            </tr>
	                        </tbody>
	                    </table>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- MODAL DE SELEÇÃO DE PROFISSÃO -->
	<div id="modalListaDepartamentos" class="modal">
	    <div class="modal-container" style="max-width: 90vw; width: 1000px;">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h2 class="modal-title">Selecionar departamento</h2>
	                <button type="button" class="modal-close" id="fecharModalListaDepartamento">
	                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor"
	                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
	                        <line x1="18" y1="6" x2="6" y2="18"></line>
	                        <line x1="6" y1="6" x2="18" y2="18"></line>
	                    </svg>
	                </button>
	            </div>
	            <div class="modal-body">
	
	                <!-- BARRA DE FILTRO E DROPDOWN -->
	                <div class="form-inline mb-3">
	                    <div class="navegacaoLista custom-button-container">
						    <!-- Botão à esquerda -->
						    <div class="botoes-esquerda">
						        
						    </div>
						    <!-- Campo de pesquisa + botão de dropdown à direita -->
						    <div class="botoes-direita">
						        <input type="text" id="filtroDepartamentos" class="form-control shadow-cantos" placeholder="Pesquisar...">
								<div class="dropdown botoes">
								  <button class="btn btn-primary" type="button" id="dropdownMenuButtonDepartamentos">
								    <svg xmlns="http://www.w3.org/2000/svg" 
								       width="16" height="16" fill="currentColor" 
								       class="bi bi-search" viewBox="0 0 16 16">
								    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 
								      1 0 0 0 1.415-1.414l-3.85-3.85zm-5.242 1.398a5 5 0 1 1 0-10 
								      5 5 0 0 1 0 10z"/>
								  	</svg>
								  </button>
								  <div class="dropdown-menu" id="dropdownCamposDepartamentos">
								      <h1 class="dropdown-item-titulo text-center">Campos Visíveis</h1>
								      <label class="dropdown-item-1"><input type="checkbox" id="selecionarTodosDepartamentos"> <span>Selecionar Todos</span></label>
								      <label class="dropdown-item-1"><input type="checkbox" class="campoCheckbox" id="campoCodigoDepartamento" checked> <span>Codigo</span></label>
								      <label class="dropdown-item-1"><input type="checkbox" class="campoCheckbox" id="campoNomeDepartamento" checked> <span>Nome</span></label>
								  </div>
								</div>
						    </div>
						</div>
	                </div>
	
	                <!-- TABELA DE PROFISSÕES -->
	                <div class="table-container-modal">
	                    <table class="table table-striped" id="tabela">
	                        <thead>
	                            <tr>
	                                <th class="text-left">Cod</th>
	                                <th class="text-left">Nome</th>
	                            </tr>
	                        </thead>
	                        <tbody>
	                            <tr th:each="department : ${departments}" class="linha-departamento" style="cursor: pointer;"
	                                th:data-id="${department.departmentId}" th:data-nome="${department.departmentName}">
	                                <td th:text="${department.departmentId}"></td>
	                                <td th:text="${department.departmentName}"></td>
	                            </tr>
	                        </tbody>
	                    </table>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>

	<div th:replace="~{fragments/sidebar :: modals}"></div>
	 
	<div th:replace="~{fragments/footer :: footer}"></div>
	
	<script>
	document.addEventListener('DOMContentLoaded', function () {
	    const select = document.getElementById('userRoleSelect');
	    const description = document.getElementById('roleDescription');

	    const permissionGroups = {
	        user: document.querySelector('.user-group'),
	        department: document.querySelector('.department-group'),
	        occupation: document.querySelector('.occupation-group'),
	        function: document.querySelector('.function-group'),
	        project: document.querySelector('.project-group'),
	        acronym: document.querySelector('.acronym-group'),
	        report: document.querySelector('.report-group')
	    };

	    const roleDescriptions = {
	        'DIRECTOR': 'Diretor: possui acesso total ao sistema, incluindo todas as configurações e permissões.',
	        'MANAGER': 'Gerente: gerencia usuários, projetos e relatórios, com acesso administrativo intermediário.',
	        'ADMIN': 'Administrador: controla cadastros, permissões e gerencia os principais módulos do sistema.',
	        'USER': 'Usuário: acesso básico, limitado apenas a relatórios.'
	    };

	    // Função para desmarcar todos os checkboxes de um grupo específico, incluindo o "Marcar Todos"
	    function uncheckGroup(group) {
	        if (group) {
	            const checkboxes = group.querySelectorAll('input[type="checkbox"]');
	            checkboxes.forEach(cb => {
	                cb.checked = false;
	            });
	        }
	    }

	    // Função para habilitar ou desabilitar o checkbox "Marcar Todos" de um grupo
	    function setCheckAllDisabledState(groupId, isDisabled) {
	        const checkAll = document.getElementById(`checkAll${groupId.charAt(0).toUpperCase() + groupId.slice(1)}`);
	        if (checkAll) {
	            checkAll.disabled = isDisabled;
	        }
	    }

	    // Função para atualizar a visibilidade dos grupos de permissões
	    function updateGroupVisibility(role) {
	        // Desabilita todos os "Marcar Todos" por padrão
	        Object.keys(permissionGroups).forEach(key => {
	            if (permissionGroups[key]) {
	                permissionGroups[key].style.display = 'none';
	                setCheckAllDisabledState(key, true);
	            }
	        });

	        if (role === 'DIRECTOR' || role === 'ADMIN') {
	            Object.keys(permissionGroups).forEach(key => {
	                if (permissionGroups[key]) {
	                    permissionGroups[key].style.display = 'block';
	                    setCheckAllDisabledState(key, false); // Habilita quando visível
	                }
	            });
	        } 
	        else if (role === 'MANAGER') {
	            ['user', 'project', 'report'].forEach(key => {
	                if (permissionGroups[key]) {
	                    permissionGroups[key].style.display = 'block';
	                    setCheckAllDisabledState(key, false); // Habilita quando visível
	                }
	            });
	        } 
	        else if (role === 'USER') {
	            if (permissionGroups.report) {
	                permissionGroups.report.style.display = 'block';
	                setCheckAllDisabledState('report', false); // Habilita quando visível
	            }
	        }
	    }

	    // Atualiza a descrição do papel
	    function updateDescription() {
	        const role = select.value;
	        description.textContent = roleDescriptions[role] || '';
	    }

	    // Função para ativar "selecionar todos" em cada grupo
	    function addCheckAllHandler(groupClass, checkAllId) {
	        const checkAll = document.getElementById(checkAllId);
	        const group = document.querySelector('.' + groupClass);

	        if (checkAll && group) {
	            checkAll.addEventListener('change', function () {
	                const checkboxes = group.querySelectorAll('input[type="checkbox"]:not(#' + checkAllId + ')');
	                checkboxes.forEach(cb => cb.checked = checkAll.checked);
	            });
	        }
	    }
	    
	    // --- Lógica de inicialização específica para a página de edição ---
	    const initialRole = select.value;
	    updateGroupVisibility(initialRole);
	    updateDescription();

	    // --- Eventos ---
	    select.addEventListener('change', () => {
	        const newRole = select.value;
	        
	        // Desmarca todos os checkboxes antes de atualizar a visibilidade
	        Object.keys(permissionGroups).forEach(key => {
	            uncheckGroup(permissionGroups[key]);
	        });

	        updateGroupVisibility(newRole);
	        updateDescription();
	    });

	    // Ativa "selecionar todos" para cada grupo
	    addCheckAllHandler('user-group', 'checkAllUser');
	    addCheckAllHandler('department-group', 'checkAllDepartment');
	    addCheckAllHandler('occupation-group', 'checkAllOccupation');
	    addCheckAllHandler('function-group', 'checkAllFunction');
	    addCheckAllHandler('project-group', 'checkAllProject');
	    addCheckAllHandler('acronym-group', 'checkAllAcronym');
	    addCheckAllHandler('report-group', 'checkAllReport');
	});
	</script>

    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>
	
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script th:src="@{/js/director/components.js}"></script>
    
	<script th:src="@{/js/director/edits/editUsers.js}"></script>

</body>
</html>